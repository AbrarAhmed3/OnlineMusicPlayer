<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Indian Radio · Advanced Player</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .heart { transition: color 0.15s, transform 0.13s; cursor:pointer; stroke-width:2; stroke:#e11d48;}
    .heart.fav { fill: #e11d48; color: #e11d48; transform: scale(1.09);}
    .logo-fallback {
      background: linear-gradient(135deg, #27ca5c70 0%, #121920 100%);
      color: #fff;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size:1.3rem;
      overflow: hidden;
      user-select: none;
    }
    /* Custom Scrollbars */
    .scrollbar-thin::-webkit-scrollbar { width: 8px; }
    .scrollbar-thin::-webkit-scrollbar-thumb { background: #18994444; border-radius:9px;}
    .scrollbar-thin { scrollbar-width: thin; scrollbar-color: #18994444 transparent;}

    /* For nav highlight */
    .active-nav { background:#22c55e !important; color:white !important; }
    .logo-on-bar { font-size:1.08rem;padding:0;}
    /* Pulse dot */
    .pulse-dot {animation: pulsedot 1.2s infinite;}
    @keyframes pulsedot {
      0% {box-shadow: 0 0 0 0 #22c55e80;}
      70%{box-shadow:0 0 0 8px #22c55e00;}
      100%{box-shadow:0 0 0 0 #22c55e00;}
    }
  </style>
</head>
<body class="bg-black text-white min-h-screen w-full flex overflow-hidden">

  <!-- Sidebar/navbar (fixed) -->
  <aside class="fixed top-0 left-0 z-30 h-screen w-60 bg-neutral-900 border-r border-neutral-800 flex flex-col py-6 px-4">
    <div class="mb-8 flex items-center">
      <svg class="w-8 h-8 text-green-500 mr-2" fill="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/></svg>
      <span class="text-white font-bold text-2xl tracking-wide">Indian Radio</span>
    </div>
    <nav class="mt-2 flex flex-col gap-2">
      <button id="allStationsTab" class="px-4 py-2 rounded active-nav font-semibold transition">All Stations</button>
      <button id="favoritesTab" class="px-4 py-2 rounded text-white hover:bg-green-700">My Stations</button>
    </nav>
    <div class="mt-auto pt-8 text-xs text-neutral-500 select-text">
      Favorites saved on your device<br>
      <span class="text-neutral-600">Powered by <a href="https://www.radio-browser.info/" target="_blank" class="text-green-400 hover:underline">Radio Browser</a></span>
    </div>
  </aside>

  <!-- Main app layout -->
  <main class="flex-1 flex flex-col ml-60 min-w-0 h-screen">
    <!-- Search and content -->
    <header class="flex items-center gap-2 px-5 pt-8 pb-3">
      <input id="searchInput" type="search" placeholder="Live search stations..." autocomplete="off"
             class="flex-1 h-12 px-5 rounded-full bg-neutral-800 border-none text-white text-lg
                    placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-green-400" />
      <svg class="w-7 h-7 text-green-400 mr-3 -ml-10 pointer-events-none" fill="none" stroke="currentColor" stroke-width="2"
          viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
    </header>
    <!-- Panels -->
    <section class="flex-1 overflow-y-auto pb-32 scrollbar-thin">
      <div id="stationsPanel"
           class="max-w-6xl mx-auto pt-2 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
      <div id="favoritesPanel"
           class="hidden max-w-6xl mx-auto pt-2 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    </section>
  </main>

  <!-- Now playing bar (with animated dot if playing, and modern layout) -->
  <footer class="fixed left-60 bottom-0 right-0 h-20 bg-gradient-to-r from-neutral-950 to-black border-t border-neutral-800 flex items-center px-7 z-40">
    <span id="nowPlayingLogo"
      class="flex justify-center items-center h-14 w-14 rounded-md bg-neutral-800 text-xl mr-4 overflow-hidden"></span>
    <div class="flex flex-col justify-center min-w-0 flex-1">
      <div class="flex items-center gap-3">
        <span id="nowPlayingName" class="text-white font-semibold text-lg truncate leading-tight">No Station Playing</span>
        <span id="playingIndicator" class="hidden ml-2 h-3 w-3 bg-green-500 rounded-full pulse-dot"></span>
      </div>
      <span id="nowPlayingTags" class="text-neutral-400 text-xs truncate max-w-sm" title="">Pick a station to play</span>
    </div>
    <div class="flex items-center gap-5 ml-6">
      <button id="playPauseBtn" class="text-white hover:text-green-400 p-0.5 rounded-full focus:outline-none">
        <svg id="playPauseIcon" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" class="h-10 w-10">
          <path d="M6 4l12 8-12 8V4z"/>
        </svg>
      </button>
      <input id="volumeSlider" type="range" min="0" max="1" step="0.01" value="1"
             class="w-24 accent-green-500 rounded bg-neutral-700 h-1" />
      <audio id="audioPlayer" hidden crossorigin="anonymous"></audio>
    </div>
  </footer>

  <script>
    // ----- Elements -----
    const allStationsTab = document.getElementById('allStationsTab');
    const favoritesTab = document.getElementById('favoritesTab');
    const stationsPanel = document.getElementById('stationsPanel');
    const favoritesPanel = document.getElementById('favoritesPanel');
    const searchInput = document.getElementById('searchInput');
    const audioPlayer = document.getElementById('audioPlayer');
    const nowPlayingName = document.getElementById('nowPlayingName');
    const nowPlayingLogo = document.getElementById('nowPlayingLogo');
    const nowPlayingTags = document.getElementById('nowPlayingTags');
    const playPauseBtn = document.getElementById('playPauseBtn');
    const playPauseIcon = document.getElementById('playPauseIcon');
    const volumeSlider = document.getElementById('volumeSlider');
    const playingIndicator = document.getElementById('playingIndicator');

    // ----- State -----
    let stations = [], favorites = [], isFavTab = false;
    let currentStation = null, isPlaying = false;
    const FAVORITES_KEY = 'indianRadioFavs';

    // Util: channel initials
    function initials(name) {
      if (!name) return "?";
      return name
        .split(' ')
        .map(p => p[0])
        .join('')
        .toUpperCase()
        .slice(0, 3);
    }

    // Favorites persist/load
    function saveFavorites() { localStorage.setItem(FAVORITES_KEY, JSON.stringify(favorites)); }
    function loadFavorites() {
      try { return JSON.parse(localStorage.getItem(FAVORITES_KEY)) || []; }
      catch { return []; }
    }
    favorites = loadFavorites();

    // ---- Station Card UI ----
    function stationCardHTML(station) {
      const isFavorite = favorites.some(s => s.stationuuid === station.stationuuid);
      let cover = "";
      if (station.favicon && station.favicon.startsWith('http')) {
        cover = `<img src="${station.favicon}" alt="${station.name}" class="h-16 w-16 rounded-lg object-cover ring-2 ring-green-500 bg-neutral-800" loading="lazy" />`;
      } else {
        cover = `<span class="h-16 w-16 rounded-lg logo-fallback">${initials(station.name)}</span>`;
      }
      return `
      <div data-uuid="${station.stationuuid}" tabindex="0"
           class="group relative flex px-3 py-4 gap-4 rounded-xl bg-neutral-900 shadow hover:scale-[1.03] focus:ring-2 ring-green-400 transition cursor-pointer overflow-hidden min-h-[110px] items-center"
           title="${station.name}">
        <div>
          ${cover}
        </div>
        <div class="flex-1 min-w-0">
          <div class="text-base font-bold truncate" title="${station.name}">${station.name}</div>
          <div class="text-xs text-green-300 truncate mb-1">${station.tags || 'No tags'}</div>
        </div>
        <button class="heart absolute right-3 top-2 z-10 ${isFavorite ? 'fav' : ''} bg-transparent border-0"
            aria-label="${isFavorite ? 'Remove from favorites' : 'Add to favorites'}"
            data-fav="${station.stationuuid}" tabindex="0">
          <svg stroke="#e11d48" stroke-width="2" fill="${isFavorite ? '#e11d48' : 'none'}" viewBox="0 0 24 24" class="w-7 h-7">
            <path d="M20.84 4.61a5.5 5.5 0 00-7.78 0l-1.06 1.06-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z"/>
          </svg>
        </button>
      </div>
      `;
    }

    // ---- Renderers ----
    function renderStations(list) {
      if (!list.length)
        return `<div class='text-neutral-400 text-center col-span-full mt-10'>No stations found.</div>`;
      return list.map(st => stationCardHTML(st)).join('');
    }
    function updateStationsPanel(list) {
      stationsPanel.innerHTML = renderStations(list);
      updateAllHearts();
    }
    function updateFavoritesPanel() {
      favoritesPanel.innerHTML = renderStations(favorites);
      updateAllHearts();
    }
    function updateAllHearts() {
      document.querySelectorAll(".heart").forEach(btn => {
        const uuid = btn.getAttribute('data-fav');
        if (favorites.some(s => s.stationuuid === uuid)) {
          btn.classList.add('fav');
          btn.setAttribute('aria-label', 'Remove from favorites');
          btn.querySelector('svg').setAttribute('fill', '#e11d48');
        } else {
          btn.classList.remove('fav');
          btn.setAttribute('aria-label', 'Add to favorites');
          btn.querySelector('svg').setAttribute('fill', 'none');
        }
      });
    }

    // ---- Live search (debounced API) ----
    let searchDebounce;
    function fetchStations(query='') {
      let apiURL = 'https://de1.api.radio-browser.info/json/stations/bycountry/India?limit=50';
      if (query && query.trim().length)
        apiURL = `https://de1.api.radio-browser.info/json/stations/search?country=India&name=${encodeURIComponent(query.trim())}&limit=50`;
      stationsPanel.innerHTML = '<div class="col-span-full text-neutral-400 mt-16 text-center">Loading stations...</div>';
      fetch(apiURL)
        .then(r => r.json())
        .then(data => {
          stations = data.filter(st => st.url_resolved);
          updateStationsPanel(stations);
        })
        .catch(() => {
          stationsPanel.innerHTML = '<div class="col-span-full text-red-500 mt-20 text-center">Failed to load.</div>';
        });
    }
    searchInput.addEventListener('input', e => {
      clearTimeout(searchDebounce);
      const q = e.target.value;
      searchDebounce = setTimeout(() => fetchStations(q), 280);
    });

    // ---- Now playing logic ----
    function playStation(station) {
      if (!station || !station.url_resolved) return;
      currentStation = station;
      audioPlayer.src = station.url_resolved;
      audioPlayer.play();
      isPlaying = true;
      nowPlayingName.textContent = station.name;
      nowPlayingTags.textContent = `${station.country || ''}${station.tags ? ' • ' + station.tags : ''}`;
      // Show logo or fallback
      if (station.favicon && station.favicon.startsWith('http')) {
        nowPlayingLogo.innerHTML = `<img src="${station.favicon}" alt="" class="h-14 w-14 rounded-md object-cover"/>`;
      } else {
        nowPlayingLogo.innerHTML = `<span class="h-14 w-14 rounded-md logo-fallback logo-on-bar">${initials(station.name)}</span>`;
      }
      updatePlayIcon();
      playingIndicator.classList.remove('hidden');
    }
    function updatePlayIcon() {
      playPauseIcon.innerHTML = isPlaying
        ? `<rect x="6" y="4" width="4" height="16" rx="1" ry="1"></rect>
           <rect x="14" y="4" width="4" height="16" rx="1" ry="1"></rect>`
        : `<path d="M6 4l12 8-12 8V4z"/>`;
      playPauseBtn.setAttribute('aria-label', isPlaying ? "Pause" : "Play");
      playingIndicator.classList.toggle('hidden', !isPlaying);
    }

    // ---- Panel navigation ----
    function showAllStationsTab() {
      allStationsTab.classList.add("active-nav");
      favoritesTab.classList.remove("active-nav");
      stationsPanel.classList.remove("hidden");
      favoritesPanel.classList.add("hidden");
      isFavTab = false;
    }
    function showFavoritesTab() {
      favoritesTab.classList.add("active-nav");
      allStationsTab.classList.remove("active-nav");
      stationsPanel.classList.add("hidden");
      favoritesPanel.classList.remove("hidden");
      isFavTab = true;
      updateFavoritesPanel();
    }
    allStationsTab.onclick = showAllStationsTab;
    favoritesTab.onclick = showFavoritesTab;

    // ---- Click events: Panel event delegation (play/fav) ----
    function handlePanelClick(panelList, getList) {
      panelList.addEventListener('click', function(e) {
        const heartBtn = e.target.closest('.heart');
        if (heartBtn) {
          const uuid = heartBtn.getAttribute('data-fav');
          const i = favorites.findIndex(s => s.stationuuid === uuid);
          if (i === -1) {
            const inList = getList().find(s => s.stationuuid === uuid);
            if (inList) { favorites.push(inList); saveFavorites(); }
          } else { favorites.splice(i,1); saveFavorites(); }
          updateStationsPanel(stations);
          updateFavoritesPanel();
          updateAllHearts();
          e.stopPropagation();
          return;
        }
        const card = e.target.closest('[data-uuid]');
        if (card) {
          const uuid = card.getAttribute('data-uuid');
          const st = getList().find(s => s.stationuuid === uuid);
          if (st) playStation(st);
        }
      });
    }
    handlePanelClick(stationsPanel, () => stations);
    handlePanelClick(favoritesPanel, () => favorites);

    // -- Play/pause --
    playPauseBtn.addEventListener('click', () => {
      if (!currentStation) return;
      if (isPlaying) { audioPlayer.pause(); }
      else { audioPlayer.play(); }
    });
    audioPlayer.addEventListener('playing', () => {
      isPlaying = true;
      updatePlayIcon();
    });
    audioPlayer.addEventListener('pause', () => {
      isPlaying = false;
      updatePlayIcon();
    });

    // Volume
    audioPlayer.volume = volumeSlider.value;
    volumeSlider.oninput = () => { audioPlayer.volume = volumeSlider.value; };

    // ---- Startup ----
    showAllStationsTab();
    fetchStations();
    updateFavoritesPanel();
    updateAllHearts();
  </script>
</body>
</html>
